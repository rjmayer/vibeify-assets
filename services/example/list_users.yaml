id: user.list.v1
name: List Users Endpoint
description: >
  Generate implementation guidance and example code for listing users with
  basic filtering, pagination, and sensible defaults.
service: user-service
version: "1.0.0"

tags:
  - user
  - http
  - list
  - backend

inputs:
  arguments:
    - name: query_params
      type: object
      description: >
        Query parameters for filtering and pagination, such as "page",
        "page_size", and optional filters like "email" or "search".
      required: false
  examples:
    - name: default_pagination
      description: Request with no explicit pagination, using defaults.
      payload:
        query_params: {}
    - name: filtered_page
      description: Request for page 2 with a page size of 20 and email filter.
      payload:
        query_params:
          page: 2
          page_size: 20
          email: "alice@example.com"

context:
  files:
    - services/example/context/db-schema.yaml
  inline:
    business_rules:
      - Responses must not leak sensitive fields (e.g. password hashes, secrets).
      - Pagination should have safe maximum limits to avoid overloading the system.
      - Results should have a stable deterministic order (e.g. created_at descending).

instructions:
  steps:
    - Read the user entity definition from the referenced db-schema.yaml file.
    - Define how pagination works, including defaults and maximums.
    - Describe filtering capabilities and how they map to the data model.
    - Provide example code or structured pseudo‑code for:
      - building a query with filters
      - applying pagination
      - shaping the response payload
    - Include recommendations for indexing and performance considerations.
  model_preferences:
    temperature: 0.2
    max_tokens: 1500

output:
  format: markdown
  schema:
    description: >
      The response must be a markdown document with the following sections:
      1) "Overview" – high‑level description of the endpoint,
      2) "Query & Pagination" – details of query parameters and behaviour,
      3) "Implementation" – example code or pseudo‑code for the logic,
      4) "Response Shape" – explanation of the returned JSON structure,
      5) "Performance Notes" – indexes or optimisations to consider.
  postprocessing_notes: >
    Humans will adapt the examples to match the exact database and ORM layer
    in use. The AI should focus on structure and behaviour rather than specific
    library calls.

tests:
  cases:
    - name: default_case
      input_ref: default_pagination
      assertions:
        must_contain:
          - "Query & Pagination"
          - "Response Shape"
